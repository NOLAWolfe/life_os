// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// --------------------------------------------------------
// MODULE: Financial Engine (The "Money Maker")
// --------------------------------------------------------

model FinancialAccount {
  id              String   @id @default(uuid()) // "account_id" from Tiller
  name            String
  institution     String?
  type            String?  // checking, savings, credit
  balance         Float    @default(0)
  lastUpdated     DateTime @default(now())
  
  // Relations
  transactions    Transaction[]

  @@index([type])
}

model Transaction {
  id              String   @id @default(uuid()) // "transaction_id" from Tiller
  date            DateTime
  description     String
  amount          Float
  type            String   // debit, credit
  category        String?
  isLateral       Boolean  @default(false)
  isSideHustle    Boolean  @default(false)
  
  // Relations
  accountId       String?
  account         FinancialAccount? @relation(fields: [accountId], references: [id])

  @@index([date])
  @@index([category])
  @@index([accountId])
}

model DebtItem {
  id              String   @id @default(uuid())
  name            String
  balance         Float
  interestRate    Float
  minPayment      Float
  dueDate         String?
  category        String?  // student_loan, credit_card, auto
  priority        Int      @default(0)
}

model IncomeStreamConfig {
  name            String   @id // The stream name (e.g. "Gusto")
  alias           String?
  type            String   // active, side, passive, ignored
  target          Float    @default(0)
}

// --------------------------------------------------------
// MODULE: Professional Hub (QA Co-Pilot)
// --------------------------------------------------------

model UserStory {
  id                Int      @id @default(autoincrement())
  title             String
  description       String?  // Rich context, mimicking ADO/Jira "Description"
  state             String   @default("New") // New, Active, Closed
  assignedTo        String?
  acceptanceCriteria String?
  createdAt         DateTime @default(now())
}

model Bug {
  id                Int      @id @default(autoincrement())
  title             String
  state             String   @default("Active")
  severity          Int      @default(3)
  createdAt         DateTime @default(now())
}

// --------------------------------------------------------
// MODULE: Life Admin (Personal Goals)
// --------------------------------------------------------

model DailyRead {
  id              Int      @id @default(autoincrement())
  title           String
  author          String?
  type            String   // book, article, course
  status          String   @default("in_progress")
  progress        Int      @default(0)
  total           Int      @default(100)
  link            String?
  notes           String?
}

model WorkoutLog {
  id              String   @id @default(uuid())
  date            DateTime @default(now())
  templateName    String
  details         String?  // JSON string for specific exercises
}

model Recipe {
  id          String   @id @default(uuid())
  name        String
  ingredients String   // JSON string: ["Chicken", "Rice"]
  tags        String?  // "high-protein", "diabetic-friendly"
  consumer    String   // "All", "Neauxla", "Partner"
  createdAt   DateTime @default(now())
}

model WeeklyPlan {
  id        String   @id @default(uuid())
  weekStart DateTime // The Monday of the week
  data      String   // JSON Blob: { "YYYY-MM-DD": { "Neauxla": { "Dinner": "RecipeID" } } }
}

// --------------------------------------------------------
// MODULE: Social Hub (DJ Business Admin)
// --------------------------------------------------------

model Client {
  id              String   @id @default(uuid())
  name            String
  company         String?
  email           String?
  invoiceEmail    String?  // The specific sender address for automated intake matching
  phone           String?
  rate            Float?   // Default rate
  rateType        String?  // 'hourly' or 'flat'
  status          String   @default("Active") // Active, Lead, Archived
  createdAt       DateTime @default(now())

  // Relations
  invoices        Invoice[]
}

model Invoice {
  id              String   @id @default(uuid())
  number          String   @default("TEMP-INV") // n8n can overwrite this or we can generate it
  status          String   @default("Draft") // Draft, Sent, Paid, Overdue, Review
  source          String   @default("Manual") // Manual, Email, Upload
  originId        String?  // e.g. Email ID or File Hash
  date            DateTime @default(now())
  dueDate         DateTime?
  totalAmount     Float
  items           String   // JSON string of line items: [{ desc, qty, rate, total }]
  notes           String?
  
  // Relations
  clientId        String
  client          Client   @relation(fields: [clientId], references: [id])
}